# 实验公式

$$f=\underset{f\in\sum^n _{i=1}}{arg\,min}\quad l(f(g(x_i)),y_i)+η||f||^2_K +λ\overline{D_f}(D_s,D_t)+ρR_f (D_s,D_t)$$

### 公式求解

#### 1. 损失函数项
与MEDA里面一样，$f$的损失函数用平方损失函数：

$l(f(g(x_i)),y_i)=\displaystyle \sum^{n}_{i=1}(f(z_i)-y)^2=\displaystyle \sum^{n+m}_{i=1}A_{ii}(f(z_i)-y)^2=||(Y-\beta^TK)A||^2$

$s.t.\ A_{ii} = 1\quad if\ i \in D_s ,\:otherwise\: Ai i = 0$

#### 2. 结构正则化项：

由表示定理可知：

$f(z)= \displaystyle \sum^{n+m}_{i=1}β_iK(z_i,z)$

所以

$η||f||^2_K=η||\beta K||^2_K=\eta\, tr(\beta^TK\beta)$

#### 3. 分布正则化项：

$λ\overline{D_f}(D_s,D_t)$

$=(1-\mu)P(z_s,z_t)+\mu Q(z_s,z_t) + \gamma \displaystyle \sum^{C}_{c=0} tr(\beta^TKZ_cK^TKZ_cK^T\beta)$

$=tr (β^T KVKβ)$

$where: V=(1-\mu)M_0 + \mu M + \gamma ZK^TKZ$

### *Note: 这里使用$ZK^TKZ$的效果并不好，换成$ZX^TXZ$的效果会好很多，但是从公式推导上暂时无法解释，所以需要找到一种推导办法推导出$ZX^TXZ$*

#### 4. 流形正则项：

$R_f(D_s,D_t) = tr(\beta^TKLK\beta)$

#### f的最终表达式

$f=\underset{f\in\sum^n _{i=1}}{arg\,min}\quad ||(Y-\beta^TK)A||^2+ηtr(\beta^TK\beta) +λtr (β^TKMKβ)+ρ\,tr(\beta^TKLK\beta)$

它是一个无约束的二次凸优化问题1，对beta求导，零其导数=0，得到beta的解：

$β^* = ((A + λV + ρL)K + ηI)^{−1}AY^T$

## 实验设置

只与MEDA进行对比，因为在MEDA的论文里MEDA优于其他所有方法

对于目标域伪标签，使用的是```1NN```进行分类，但是晓雯有在

```Caltech-Office31```上实验过将分类器替换成了线性分类器会提升最终结果，因此后续可以考虑将其他的数据集也换成线性分类器试一下

多核现在还没有实现，只是手工调了一个多核：

$$0.1*rbf核 + 0.9*sam核$$

这个多核的结果会比单核好```0~0.4%```

# 实验结果

## Caltech-Office31（SURF）

> ```gamma=0.15```, 平均提升 ```1.7855%```, (目标域伪标签分类是使用的线性分类器)

DataSet | MEDA |  MK-MMD | Relative Performance
:-:|:-:|:-:|:-:
C->A | 56.5762% | 56.5762% | 0.1044%
C->W | 53.8983% | 57.9661% | 4.0678%
C->D | 50.3185% | 61.7834% | 11.4650%
A->C | 43.9893% | 44.4346% | 0.0000%
A->W | 53.2203% | 57.6271% | 3.3898%
A->D | 45.8599% | 49.6815% | 3.8217%
W->C | 34.1941% | 33.8379% | -0.5343%
W->A | 42.6931% | 43.0063% | 0.3132%
W->D | 88.5350% | 88.5350% | 0.0000%
D->C | 34.9065% | 35.5298% | 0.6233%
D->A | 41.2317% | 41.8580% | 0.2088%
D->W | 87.4576% | 85.0847% | -2.0339%

## MNIST-USPS

> ```gamma=0.5```, 平均提升 ```1.7028%```

DataSet | MEDA |  MK-MMD | Relative Performance
:-:|:-:|:-:|:-:
USPS->MNIST | 89.0000% | 90.0556% | 1.0556%
MNIST->USPS | 74.8000% | 77.1500% | 2.3500%

## PIE

> ```gamma=0.185```, 平均提升 ```0.9116%```

DataSet | MEDA |  MK-MMD | Relative Performance
:-:|:-:|:-:|:-: 
05->07 | 39.4721% | 40.5770% | 1.1050%
05->09 | 44.6078% | 46.6299% | 2.0221%
05->27 | 64.8543% | 67.7681% | 2.9138%
05->29 | 34.0074% | 35.0490% | 1.0417%
07->05 | 46.2785% | 47.1188% | 0.8403%
07->09 | 50.7966% | 51.7157% | 0.9191%
07->27 | 71.3127% | 71.2226% | -0.0901%
07->29 | 37.5000% | 38.2353% | 0.7353%
09->05 | 46.8788% | 48.3794% | 1.5006%
09->07 | 48.8029% | 48.1277% | -0.6753%
09->27 | 72.8747% | 73.2953% | 0.4205%
09->29 | 45.4657% | 46.8750% | 1.4093%
27->05 | 70.0480% | 72.6591% | 2.6110%
27->07 | 74.7084% | 74.7084% | 0.0000%
27->09 | 82.0466% | 80.8211% | -1.2255%
27->29 | 54.9020% | 56.3113% | 1.4093%
29->05 | 38.9556% | 40.8463% | 1.8908%
29->07 | 37.3235% | 37.5077% | 0.1842%
29->09 | 44.5466% | 45.4657% | 0.9191%
29->27 | 53.2592% | 53.5596% | 0.3004%

## COIL

> ```gamma=0.15```, 平均提升 ```1.8056%```

DataSet | MEDA |  MK-MMD | Relative Performance
:-:|:-:|:-:|:-: 
COIL_01 | 90.1389% | 91.2500% | 1.1111%
COIL_02 | 87.0833% | 89.5833% | 2.5000%

## Office31-Decaf6

> gamma无论是几，平均结果都是降的，但是降得不多，都在```-0.5%```以内，下表给出的是```gamma=0.4```的实验结果，平均性能提升```-0.1997%```

DataSet | MEDA |  MK-MMD | Relative Performance
:-:|:-:|:-:|:-:
C->A | 93.4238% | 93.5282% | 0.1044%
C->W | 95.5932% | 95.5932% | 0.0000%
C->D | 91.7197% | 91.7197% | 0.0000%
A->C | 87.4443% | 87.4443% | 0.0000%
A->W | 88.8136% | 87.7966% | -1.0169%
A->D | 87.8981% | 87.2611% | -0.6369%
W->C | 88.0677% | 87.4443% | -0.6233%
W->A | 93.2150% | 93.1106% | -0.1044%
W->D | 99.3631% | 99.3631% | 0.0000%
D->C | 87.5334% | 87.6224% | 0.0890%
D->A | 93.2150% | 93.0063% | -0.2088%
D->W | 97.6271% | 97.6271% | 0.0000%